<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="无限进步 💪 ">
    <meta name="keywords"  content="">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="k8s搭建ELK步骤详解 - 维林撒的博客 | WS Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="1.准备工作
">
    
    <meta property="article:published_time" content="2021-05-05T01:00:00Z">
    
    
    <meta property="article:author" content="WS">
    
    
    <meta property="article:tag" content="k8s">
    
    <meta property="article:tag" content="elk">
    
    <meta property="article:tag" content="devops">
    
    
    <meta property="og:image" content="https://willingsasi.github.io//img/me.jpeg">
    <meta property="og:url" content="https://willingsasi.github.io//2021/05/05/k8s-k8s%E6%90%AD%E5%BB%BAELK%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3/">
    <meta property="og:site_name" content="维林撒的博客 | WS Blog">
    
    <title>k8s搭建ELK步骤详解 - 维林撒的博客 | WS Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://willingsasi.github.io//2021/05/05/k8s-k8s%E6%90%AD%E5%BB%BAELK%E6%AD%A5%E9%AA%A4%E8%AF%A6%E8%A7%A3/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>

<script type="text/javascript" color="238,205,205" opacity='0.7' zIndex="-2" count="99" src="../../../../js/canvas-nest.min.js"></script>
<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">WS Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                    <li>
                        <a href="/work/">Archive</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/post-bg-2015.jpg" width="0" height="0"> -->

<!-- Post Header -->
<!-- canvas-nest.min.js -->
<!--<script type="text/javascript" src="../../../../js/canvas-nest.min.js"></script>-->
<head>
    <link href="../../../../css/rouge.css" rel="stylesheet">
</head>
<script type="text/javascript" color="238,205,205" opacity='0.7' zIndex="-2" count="99" src="../../../../js/canvas-nest.min.js"></script>
<!--//添加评论系统-->
<link rel="stylesheet" href="../../../../css/gitalk.css">
    <script src="../../../../js/gitalk.min.js"></script>
<!--    打赏-->
<link href="/css/reward.css?v=6.2.0" rel="stylesheet" type="text/css" />
<!-- 大图浏览 -->
<link href="../../../../css/imageContent.css" rel="stylesheet">

<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/post-bg-2015.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#k8s" title="k8s">k8s</a>
                        
                        <a class="tag" href="/tags/#elk" title="elk">elk</a>
                        
                        <a class="tag" href="/tags/#devops" title="devops">devops</a>
                        
                    </div>
                    <h1>k8s搭建ELK步骤详解</h1>
                    
                    
                    <h2 class="subheading"> "Hello K8s, Hello ELK"</h2>
                    
                    <span class="meta">Posted by WS on May 5, 2021</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                


				<h2 id="1准备工作">1.准备工作</h2>

<blockquote>
  <ol>
    <li>
      <p>安装minikube, 安装kubectl(不再赘述, 自行查找)</p>
    </li>
    <li>
      <p>启动minikube</p>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>minikube start image-mirror-country<span class="o">=</span><span class="s1">'cn'</span> <span class="nt">--registry-mirror</span><span class="o">=</span>https://registry.docker-cn.com <span class="nt">--memory</span><span class="o">=</span>4096 <span class="nt">--image-repository</span><span class="o">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>新建k8s namespace, 用于逻辑隔离整套elk服务</p>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>kubectl create namespace elkspace
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<h2 id="2编写k8s-yaml文件标记都是注释-copy请删除">2.编写k8s yaml文件(###标记都是注释, copy请删除)</h2>

<blockquote>
  <ol>
    <li>
      <p>elasticsearch.yaml</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>  <span class="c1">###启动es容器, 级别可以是Pod等,有不同定义的</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">es-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>  <span class="c1">###第一步已定义, 可以全部不使用, 走默认default namespace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>  <span class="c1">###定义k:v格式标签, 用于Service通过标签查询并连接</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">es-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">elasticsearch:7.9.1</span>  <span class="c1">###docker镜像, 注意ELK三者的版本号请统一</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">es</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">0.5</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">500Mi</span>
          <span class="na">env</span><span class="pi">:</span>  <span class="c1">###环境变量, 相当于docker run中的-e参数</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">discovery.type"</span>  <span class="c1">###单节点es</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">single-node"</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ES_JAVA_OPTS</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-Xms512m</span><span class="nv"> </span><span class="s">-Xmx2g"</span>
          <span class="na">ports</span><span class="pi">:</span>  <span class="c1">###设置容器暴露端口, 相当于设置Pod端口9200,9300 tcp可用</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9200</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9300</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>  <span class="c1">###启动服务, 用于对外暴露Pod信息, 因为k8s外无法直连Pod, 必须通过Service暴露出去端口</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">es-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>  <span class="c1">###相当于Pod端口映射Node端口, 外部访问通过NodeIP+NodePort就可以连到服务</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">esport</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9200</span>  <span class="c1">###Service连接Pod端口</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9200</span>  <span class="c1">###上面暴露的es Pod端口</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30011</span>  <span class="c1">###k8s外部访问端口, 自定义, 但是有范围</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">esportlink</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9300</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9300</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30021</span>
    <span class="na">selector</span><span class="pi">:</span>  <span class="c1">###很重要, 服务绑定到指定K:V形式的Pod, 上面配置好的</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>kibana.yaml</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kb</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">kibana:7.9.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">env</span><span class="pi">:</span>  <span class="c1">###非常重要!!!服务之间ip动态变化, 配置连接最好用域名, Service域名规则是:service.namespace</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ELASTICSEARCH_HOSTS</span>  <span class="c1">###非常重要!!!注意是ELASTICSEARCH_HOSTS还是ELASTICSEARCH_URL, 得和当前版本kibana中/usr/share/kibana/config/kibana.yml的参数名称一样, 可以docker启动镜像进去看看</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://es-single-service.elkspace:9200"</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">XPACK_SECURITY_ENABLED</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ui</span>
            <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5601</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">0.5</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">500Mi</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">5601</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5601</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30031</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>logstash.yaml</p>

      <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">log-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">log-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">logstash:7.9.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5044</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>  <span class="c1">###该容器需要挂载的地址,也就是logstash.conf,因为logstash日志接收和转发信息都在此文件配置</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log-config</span>
            <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/logstash/pipeline</span>
          <span class="na">env</span><span class="pi">:</span>  <span class="c1">###非常重要!!!和上一步的kibana此处配置一样的效果,参数名称需要和logstash/config/中配置文件一样</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">XPACK_MONITORING_ELASTICSEARCH_HOSTS</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://es-single-service.elkspace:9200"</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">volumes</span><span class="pi">:</span>  <span class="c1">###指定从哪里挂载目录</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log-config</span>  <span class="c1">###对应到volumeMounts中的name</span>
          <span class="na">hostPath</span><span class="pi">:</span>  <span class="c1">###从当前Node本地路径加载,直接写我自己电脑绝对路径不对,此时的Node是minikube容器,所以这个地址也是minikube的目录,所以首先得把电脑本地路径挂载到minikube路径, 然后这里才能取到配置文件等信息(下一步说明)</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/data/pipeline</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">lg-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">5044</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5044</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30041</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>本地随便找个地方新建logstash.conf文件, 就是上一步中hostPath挂载的logstash.conf配置文件, 文件信息如下, 注意es 服务的地址, 和上面配置的一样</p>

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>input {
  tcp {
    port =&gt; 5044
    mode =&gt; "server"
  }
}
   
output {
  elasticsearch {
    hosts =&gt; ["es-single-service.elkspace:9200"]
    index =&gt; "apidemo"
  }
   
  stdout{
    codec =&gt; rubydebug
  }
}
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>然后本地路径挂载minikube指定地址, &amp;表示后台操作</p>

      <blockquote>
        <p>/Users/grahamliu/elk/pipeline 电脑本地logstash.conf所在目录</p>

        <p>/data/pipeline minikube指定地址, 也就是第3步中配置的hostpath, minikube文件目录详细信息可自行查阅</p>
      </blockquote>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>minikube mount /Users/grahamliu/elk/pipeline:/data/pipeline &amp;
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<h2 id="3启动上面的各项配置文件自行查询">3.启动上面的各项配置文件(自行查询)</h2>

<h2 id="4外部如何打开k8s中的kibana-如何连接写入日志到k8s-logstash">4.外部如何打开k8s中的Kibana? 如何连接写入日志到k8s logstash?</h2>

<blockquote>
  <ol>
    <li>
      <p>咱们部署是是单Node服务, 所有外部访问都是通过NodeIP+NodePort访问</p>
    </li>
    <li>
      <p>查询minikube node的命令, InternalIP:  192.168.xx.x</p>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>pro-2:~ grahamliu<span class="nv">$ </span>kubectl get node
NAME       STATUS   ROLES    AGE    VERSION
minikube   Ready    master   117d   v1.17.3
pro-2:~ grahamliu<span class="nv">$ </span>kubectl describe node minikube
Name:               minikube
Roles:              master
Labels:             beta.kubernetes.io/arch<span class="o">=</span>amd64
                    beta.kubernetes.io/os<span class="o">=</span>linux
                    kubernetes.io/arch<span class="o">=</span>amd64
                    kubernetes.io/hostname<span class="o">=</span>minikube
                    kubernetes.io/os<span class="o">=</span>linux
                    node-role.kubernetes.io/master<span class="o">=</span>
Annotations:        kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock
                    node.alpha.kubernetes.io/ttl: 0
                    volumes.kubernetes.io/controller-managed-attach-detach: <span class="nb">true
</span>CreationTimestamp:  Sun, 03 Jan 2021 11:57:08 +0800
Taints:             &lt;none&gt;
Unschedulable:      <span class="nb">false
</span>Conditions:
  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  <span class="nt">----</span>             <span class="nt">------</span>  <span class="nt">-----------------</span>                 <span class="nt">------------------</span>                <span class="nt">------</span>                       <span class="nt">-------</span>
  MemoryPressure   False   Fri, 30 Apr 2021 16:45:08 +0800   Sun, 03 Jan 2021 11:57:02 +0800   KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure     False   Fri, 30 Apr 2021 16:45:08 +0800   Sun, 03 Jan 2021 11:57:02 +0800   KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure      False   Fri, 30 Apr 2021 16:45:08 +0800   Sun, 03 Jan 2021 11:57:02 +0800   KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready            True    Fri, 30 Apr 2021 16:45:08 +0800   Sun, 03 Jan 2021 11:57:11 +0800   KubeletReady                 kubelet is posting ready status
Addresses:
  InternalIP:  192.168.xx.x
  Hostname:    minikube
Capacity:
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
    <li>
      <p>此时只要用以上ip加上之前Service中暴露的端口就能成功访问各个服务了, 可以用命令查询所有端口信息</p>

      <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>pro-2:~ grahamliu<span class="nv">$ </span>kubectl get svc <span class="nt">-n</span> elkspace
NAME                TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                         AGE
es-single-service   NodePort   10.100.233.92    &lt;none&gt;        9200:30011/TCP,9300:30021/TCP   22h
kb-single-service   NodePort   10.104.129.185   &lt;none&gt;        5601:30031/TCP                  3h22m
lg-single-service   NodePort   10.111.174.220   &lt;none&gt;        5044:30041/TCP                  176m
</pre></td></tr></tbody></table></code></pre></div>      </div>
    </li>
  </ol>
</blockquote>

<h2 id="5整个流程都通了以后-其实elk三个yaml可以整合到一个yaml一次性启动-elkyaml编排如下">5.整个流程都通了以后, 其实elk三个yaml可以整合到一个yaml一次性启动, elk.yaml编排如下</h2>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
</pre></td><td class="rouge-code"><pre><span class="na">kind</span><span class="pi">:</span> <span class="s">List</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">items</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">es-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">es-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">elasticsearch:7.9.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">es</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">0.5</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">500Mi</span>
          <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">discovery.type"</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">single-node"</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ES_JAVA_OPTS</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-Xms512m</span><span class="nv"> </span><span class="s">-Xmx2g"</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9200</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">9300</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">es-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">esport</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9200</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9200</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30011</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">esportlink</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">9300</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">9300</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30021</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">es-single</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">kb</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">kibana:7.9.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ELASTICSEARCH_HOSTS</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://es-single-service.elkspace:9200"</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">XPACK_SECURITY_ENABLED</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ui</span>
            <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5601</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">1</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">2Gi</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="m">0.5</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">500Mi</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">kb-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">5601</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5601</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30031</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">kb-single</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">log-single</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">log-single</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">logstash:7.9.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">5044</span>
            <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">volumeMounts</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log-config</span>
            <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/usr/share/logstash/pipeline</span>
          <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">XPACK_MONITORING_ELASTICSEARCH_HOSTS</span>
            <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://es-single-service.elkspace:9200"</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">volumes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log-config</span>
          <span class="na">hostPath</span><span class="pi">:</span>
            <span class="na">path</span><span class="pi">:</span> <span class="s">/data/pipeline</span>
<span class="pi">-</span> <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">lg-single-service</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">elkspace</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">5044</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">5044</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30041</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">log-single</span>
</pre></td></tr></tbody></table></code></pre></div></div>



                <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a></div>
                <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["weixin","qzone","tsina","tqq","twi","fbook"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["weixin","qzone","tsina","tqq","twi","fbook"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

                <hr style="visibility: hidden;">

            <!-- 打赏功能 -->
            <!-- <div>
                <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
                <div>☛兄dei，请我喝杯茶☚</div>
                <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
                    <span>打赏</span>
                </button>
                <div id="QR" style="display: none;">
                        
                        
                <div id="wechat" style="display: inline-block">
                <img id="wechat_qr" src="/img/payimg/weipayimg.jpg" alt="yizibi 微信支付"/>
                            <p>微信支付</p>
                </div>
                        
                        
                        
                <div id="alipay" style="display: inline-block">
                <img id="alipay_qr" src="/img/payimg/alipayimg.jpg" alt="yizibi 支付宝"/>
                <p>支付宝</p>
                </div>
                        
                        
                        
                        
                </div>
                </div>
                
            </div> -->
            

   <!--  上一篇或者下一篇post按钮 -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/04/18/Springboot%E9%85%8D%E7%BD%AEElasticsearchRepository%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8/" data-toggle="tooltip" data-placement="top" title="Springboot配置ElasticsearchRepository接口使用">
                        Previous<br>
                        <span>Springboot配置ElasticsearchRepository接口使用</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/05/16/%E9%9A%8F%E8%AE%B0-%E6%9A%97%E6%B7%A1%E8%93%9D%E7%82%B9/" data-toggle="tooltip" data-placement="top" title="暗淡蓝点">
                        Next<br>
                        <span>暗淡蓝点</span>
                        </a>
                    </li>
                    
                </ul>


<!--                -->

<!--                <div id="disqus_thread"></div>-->
<!--                <script>-->
<!--                    -->
<!--                    /**-->
<!--                     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.-->
<!--                     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/-->
<!--                 var disqus_config = function () {-->
<!--                 this.page.url = site.page.url;  // Replace PAGE_URL with your page's canonical URL variable-->
<!--                 this.page.identifier = site.page.identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable-->
<!--                 };-->
<!--                 -->
<!--                (function() { // DON'T EDIT BELOW THIS LINE-->
<!--                 var d = document, s = d.createElement('script');-->
<!--                 s.src = 'https://yizibi.disqus.com/embed.js';-->
<!--                 s.setAttribute('data-timestamp', +new Date());-->
<!--                 (d.head || d.body).appendChild(s);-->
<!--                 })();-->
<!--                    </script>-->
<!--                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>-->


                
                
                <!--   gitalk       -->
                
                <div class="comment">
                    <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
var gitalk = new Gitalk({
    id: '2021-05-05 01:00:00 +0000',
    clientID: 'c82ebab999f684055a7b',
    clientSecret: '0c551be36f3ae66808ef1d1dcd1cf8226e6b113d',
    repo: 'willingsasi.github.io',
    owner: 'willingsasi',
    admin: ['willingsasi'], 
	labels: ['Gitalk'],
})
gitalk.render('gitalk-container')
</script> 

                </div>
                
            </div>  

    <!-- Side Catalog Container -->
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
        				
                            
                				<a href="/tags/#elk" title="elk" rel="3">
                                    elk
                                </a>
                            
        				
                            
                				<a href="/tags/#devops" title="devops" rel="3">
                                    devops
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#随记" title="随记" rel="3">
                                    随记
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#图片分享" title="图片分享" rel="2">
                                    图片分享
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                </ul>
                
            </div>
        </div>
    </div>
    

    
</article>
<!-- 大图浏览 -->
<!-- <div id="image-cover-modal" class="image-cover-modal">
	<img id="image-cover-image" class="image-cover-modal-content">
	<div id="image-cover-caption"></div>
  </div>
  <script>
  // Get the DOM
  var modal = document.getElementById('image-cover-modal');
  var modalImg = document.getElementById("image-cover-image");
  var captionText = document.getElementById("image-cover-caption");
  var span = document.getElementsByClassName("image-cover-close")[0];
  
  // When the user clicks on <span> (x), close the modal
  modal.onclick = function() {
	  this.classList.remove("model-shown");
  }
  
  var i;
  for (i = 0; i < document.images.length; i++) {
  
	  // Get the image and insert it inside the modal - use its "alt" text as a caption
	  var img = document.images[i];
  
	  img.onclick = function(){
		  modal.classList.add("model-shown");
		  modalImg.src = this.src;
		  captionText.innerHTML = this.alt;
	  }
  }
  </script> -->

<!-- Add support for Mathjax by Voleking-->








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<!--
Author: Ray-Eldath
refer to:
 - https://github.com/theme-next/hexo-theme-next/blob/master/source/js/src/utils.js
 - https://jingyan.baidu.com/article/b2c186c83ec846c46ef6ff80.html
 - http://www.bkjia.com/jQuery/449205.html
-->
<style media="screen">
  .scroll {
    z-index: 10000;
    display: none;
    height: 24px;
    background: #222;
    color: #fff;
    line-height: 24px;
    text-align: center;
    position: fixed;
    right: 30px;
    bottom: 30px;
    cursor: pointer;
    font-size: 14px;
  }
</style>
<div class="scroll">
  <i class="fa fa-arrow-up" style="margin-left: 4px"></i>
  <span class="scrollpercent" style="margin-left: -2px"></span>
  <span style="margin-left: -4px; margin-right: 4px">%</span>
</div>

<script src="/js/util.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if (utils.isMobile()) {
      $('.scroll').hide();
      return;
    }
    $(window).scroll(function() {
      let scrollValue = $(window).scrollTop();
      var scrollPercentRounded = Math.round((scrollValue / utils.getContentVisibilityHeight()) * 100);
      var scrollPercentMaxed = (scrollPercentRounded > 100) ? 100 : scrollPercentRounded;
      $('.scrollpercent').html(scrollPercentMaxed);
      scrollValue > 100 ? $('.scroll').fadeIn() : $('.scroll').fadeOut();
    });
    $('.scroll').click(function() {
      $('html, body').animate({
        scrollTop: 0
      }, 300);
    })
  })
</script>


<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/u/1870966724">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/WillingSasi">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">
<!--                  本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次-->
                    <span class="site-uv" title="总点击人数">
                    <img src="/img/vendor/octicons/svg/person.svg" width="10" height="16">
                    <span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <span class="site-pv" title="总点击量">
                    <img src="/img/vendor/octicons/svg/eye.svg" width="16" height="16">
                    <span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <span class="page-pv"title="本页面点击人数">
                    <img src="/img/vendor/octicons/svg/file-text.svg" width="12" height="16">
                    <span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span>
                    <br>
                    Copyright &copy; WS Blog 2021
                    <br>
                    Power by <a href="https://jekyllcn.com/docs/home/">Jekyll</a> | 本站源码 <a href="https://github.com/yizibi/yizibi.github.io">yizibi</a>
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=yizibi&repo=yizibi.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
            
        </div>
    </div>
</footer>
<!--网站统计-->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Hux
    var _gaId = 'UA-124793396-1';
    var _gaDomain = 'auto';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->



<!-- Multi-Lingual -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

<script src="/js/jquery.min.js"></script>
<style>
.videoWrapper {
	position: relative;
	padding-bottom: 56.333%;
	height: 0;
    background: black;
}
.videoWrapper iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
    border: 0;
}    
</style>

<script>
function get_youtube_id(url) {
    var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
    return (url.match(p)) ? RegExp.$1 : false;
}
function vimeo_embed(url,el) {
    var id = false;
    $.ajax({
      url: 'https://vimeo.com/api/oembed.json?url='+url,
      async: true,
      success: function(response) {
        if(response.video_id) {
          id = response.video_id;
          if(url.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
          if(url.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
          var theInnerHTML = '<div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+id+'/?byline=0&title=0&portrait=0';
          if(autoplay==1) theInnerHTML += '&autoplay=1';
          if(loop==1) theInnerHTML += '&loop=1';
          theInnerHTML += '" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>'; 
          el.innerHTML = theInnerHTML;
        }
      }
    });
}
function video_embed() {
    var p = document.getElementsByTagName('p');
    for(var i = 0; i < p.length; i++) {
        //check if this is an external url (that starts with https:// or http://
        if (p[i].innerHTML.indexOf("http://") == 0 ||
            p[i].innerHTML.indexOf("https://") == 0) {
            var youtube_id = get_youtube_id(p[i].innerHTML);
            if(youtube_id) {
                if(p[i].innerHTML.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                if(p[i].innerHTML.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                var theInnerHTML = '<div class="videoWrapper"><iframe width="720" height="420" src="https://www.youtube.com/embed/' + youtube_id + '?rel=0&showinfo=0';
                if(autoplay==1) theInnerHTML += '&autoplay=1';
                if(loop==1) theInnerHTML += '&loop=1&playlist='+youtube_id+'&version=3';
                theInnerHTML += '" frameborder="0" allowfullscreen></iframe></div>';
                p[i].innerHTML = theInnerHTML;
            }
            if(p[i].innerHTML.indexOf('vimeo.com') !== -1) {
                //ask vimeo for the id and place the embed
                vimeo_embed(p[i].innerHTML,p[i]);
            }
        }
    }
}
video_embed();

function mp3_embed() {
    var p = document.getElementsByTagName('p');
    for(var i = 0; i < p.length; i++) {
        if(p[i].innerHTML.indexOf('.mp3') !== -1) {
            var str = p[i].innerHTML.split('?');
            if(str.length == 1) str[1] = '';
            var str1 = str[1];
            str1 = str1.replace('&','').replace('&','');
            str1 = str1.replace('autoplay=1','').replace('autoplay=0','');
            str1 = str1.replace('loop=1','').replace('loop=0','');
            str1 = str1.replace('controls=0','').replace('controls=1','');

            if (str[0].lastIndexOf('.mp3', str[0].length - 4) === str[0].length - 4 && str1.length == 0) {
                if(str[1].indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                if(str[1].indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                if(str[1].indexOf('controls=0') !== -1) var controls=0; else var controls=1;
                var newInnerHTML = '<audio';
                if(autoplay==1) newInnerHTML += ' autoplay';
                if(loop==1) newInnerHTML += ' loop';
                if(controls==1) newInnerHTML += ' controls';
                newInnerHTML += '><source src="'+str[0]+'" type="audio/mpeg">Your browser does not support the audio element.</audio>';
                p[i].innerHTML = newInnerHTML;
            }
        }
    }
}
mp3_embed();
</script>

<!--鼠标点击爱心动画-->
<script type="text/javascript" src="/js/src/love.js"></script>

</body>

</html>
